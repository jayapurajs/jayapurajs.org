---
---

<div class="relative inline-block text-left">
  <!-- Trigger button -->
  <button
    type="button"
    id="theme-toggle-btn"
    class="inline-flex items-center gap-2 rounded-full border border-gray-200 dark:border-slate-700 bg-white/80 dark:bg-slate-900/80 px-3 py-1 text-sm text-gray-700 dark:text-slate-200 shadow-sm hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"
  >
    <!-- Icon current mode -->
    <span id="theme-toggle-icon" class="flex items-center">
      <!-- default: system (desktop icon) -->
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 21h6M12 17v4M4 5h16v9H4z" />
      </svg>
    </span>
    <span id="theme-toggle-label" class="hidden sm:inline">
      System
    </span>
    <!-- caret -->
    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.25a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
    </svg>
  </button>

  <!-- Dropdown -->
  <div
    id="theme-dropdown"
    class="invisible opacity-0 absolute right-0 z-20 mt-2 w-40 origin-top-right rounded-xl border border-gray-100 dark:border-slate-700 bg-white dark:bg-slate-900 shadow-lg shadow-slate-900/5 ring-1 ring-black/5 transition-all duration-150"
  >
    <div class="py-1 text-sm text-gray-700 dark:text-slate-200">
      <!-- System -->
      <button
        type="button"
        data-theme="system"
        class="theme-option flex w-full items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-slate-800"
      >
        <span class="flex items-center justify-center rounded-full bg-gray-100 dark:bg-slate-800 p-1">
          <!-- desktop icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 21h6M12 17v4M4 5h16v9H4z" />
          </svg>
        </span>
        <span>System</span>
      </button>

      <!-- Light -->
      <button
        type="button"
        data-theme="light"
        class="theme-option flex w-full items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-slate-800"
      >
        <span class="flex items-center justify-center rounded-full bg-gray-100 dark:bg-slate-800 p-1">
          <!-- sun icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4V2m0 20v-2m8-8h2M2 12h2m13.657-7.657L18.364 5.05M5.636 18.364l1.707-1.707m0-10.95L5.636 5.636M18.364 18.364l-1.707-1.707M12 8a4 4 0 100 8 4 4 0 000-8z" />
          </svg>
        </span>
        <span>Light</span>
      </button>

      <!-- Dark -->
      <button
        type="button"
        data-theme="dark"
        class="theme-option flex w-full items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-slate-800"
      >
        <span class="flex items-center justify-center rounded-full bg-gray-100 dark:bg-slate-800 p-1">
          <!-- moon icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
          </svg>
        </span>
        <span>Dark</span>
      </button>
    </div>
  </div>
</div>

<script>
  if (typeof window !== "undefined") {
    const root = document.documentElement;
    const btn = document.getElementById("theme-toggle-btn");
    const dropdown = document.getElementById("theme-dropdown");
    const options = dropdown?.querySelectorAll(".theme-option");
    const labelEl = document.getElementById("theme-toggle-label");
    const iconEl = document.getElementById("theme-toggle-icon");

    const setIconAndLabel = (theme) => {
      if (!iconEl || !labelEl) return;
      labelEl.textContent = theme === "light" ? "Light" : theme === "dark" ? "Dark" : "System";
      // ganti isi iconEl.innerHTML
      if (theme === "light") {
        iconEl.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4V2m0 20v-2m8-8h2M2 12h2m13.657-7.657L18.364 5.05M5.636 18.364l1.707-1.707m0-10.95L5.636 5.636M18.364 18.364l-1.707-1.707M12 8a4 4 0 100 8 4 4 0 000-8z" />
          </svg>`;
      } else if (theme === "dark") {
        iconEl.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
          </svg>`;
      } else {
        iconEl.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 21h6M12 17v4M4 5h16v9H4z" />
          </svg>`;
      }
    };

    const applyTheme = (theme) => {
      if (theme === "light") {
        root.classList.remove("dark");
        localStorage.setItem("theme", "light");
      } else if (theme === "dark") {
        root.classList.add("dark");
        localStorage.setItem("theme", "dark");
      } else {
        localStorage.removeItem("theme");
        const systemPrefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        if (systemPrefersDark) root.classList.add("dark");
        else root.classList.remove("dark");
      }
      setIconAndLabel(theme);
    };

    // initial: baca dari localStorage / system
    const initTheme = () => {
      const stored = localStorage.getItem("theme");
      if (stored === "light" || stored === "dark") {
        applyTheme(stored);
      } else {
        applyTheme("system");
      }
    };

    const toggleDropdown = () => {
      if (!dropdown) return;
      const isOpen = dropdown.classList.contains("opacity-100");
      if (isOpen) {
        dropdown.classList.remove("opacity-100", "visible");
        dropdown.classList.add("opacity-0", "invisible");
      } else {
        dropdown.classList.remove("opacity-0", "invisible");
        dropdown.classList.add("opacity-100", "visible");
      }
    };

    btn?.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleDropdown();
    });

    document.addEventListener("click", () => {
      if (!dropdown) return;
      dropdown.classList.remove("opacity-100", "visible");
      dropdown.classList.add("opacity-0", "invisible");
    });

    options?.forEach((opt) => {
      opt.addEventListener("click", (e) => {
        e.stopPropagation();
        const theme = opt.getAttribute("data-theme") || "system";
        applyTheme(theme);
        toggleDropdown();
      });
    });

    initTheme();
  }
</script>
