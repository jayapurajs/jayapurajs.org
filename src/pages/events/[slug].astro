---
import Layout from "@/layouts/Layout.astro";
import { Image } from "astro:assets";
import { events, type Event } from "@/data/events";

export const prerender = false;

const { slug } = Astro.params;

const event = events.find((e) => e.slug === slug);

if (!event) {
  return Astro.redirect("/404");
}

function isPastEvent(dateString: string): boolean {
  const eventDate = new Date(dateString);
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  return eventDate < today;
}

const isPast = isPastEvent(event.date);

function formatDate(dateString: string): string {
  const date = new Date(dateString);
  return date.toLocaleDateString("en-US", {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<Layout title={`${event.title}`} description={event.desc}>
  <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <a
      href="/events"
      class="inline-flex items-center gap-2 mb-8 text-neutral-500 hover:text-yellow-600 transition-colors text-sm"
    >
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 19l-7-7 7-7"
        />
      </svg>
      Back to Events
    </a>

    <article>
      <!-- Header -->
      <header class="border-b border-neutral-200 pb-10 mb-12">
        <div class="flex flex-wrap justify-between items-center gap-4 mb-6">
          <div class="flex gap-2">
            <span
              class="bg-yellow-400 text-neutral-900 text-[10px] font-bold px-3 py-1 uppercase tracking-wide rounded"
            >
              #{event.category}
            </span>
            {isPast ? (
              <span class="bg-neutral-100 text-neutral-600 text-[10px] font-bold px-3 py-1 uppercase tracking-wide rounded border border-neutral-200">
                Completed
              </span>
            ) : event.registrationStatus ? (
              <span class="bg-emerald-50 text-emerald-700 text-[10px] font-bold px-3 py-1 uppercase tracking-wide rounded border border-emerald-200">
                Open Registration
              </span>
            ) : (
              <span class="bg-neutral-100 text-neutral-600 text-[10px] font-bold px-3 py-1 uppercase tracking-wide rounded border border-neutral-200">
                Registration Closed
              </span>
            )}
          </div>
          <div class="flex flex-col items-end text-right">
            <p class="text-neutral-900 font-bold text-sm">
              {formatDate(event.date)}
            </p>
            {event.time && <p class="text-neutral-500 text-xs">{event.time}</p>}
          </div>
        </div>

        <h1
          class="text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight text-neutral-900 leading-tight mb-6"
        >
          {event.title}
        </h1>

        <div class="grid md:grid-cols-12 gap-8 items-start">
          <div class="md:col-span-7">
            <p class="text-lg text-neutral-600 leading-relaxed mb-6">
              {event.desc}
            </p>

            <!-- Location with link -->
            {event.locationUrl ? (
              <a
                href={event.locationUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-start gap-4 p-5 bg-neutral-50 rounded-xl border border-neutral-200 hover:border-yellow-300 transition-colors group"
              >
                <div class="p-2 bg-yellow-400 rounded-lg">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-5 h-5 text-neutral-900"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                  </svg>
                </div>
                <div class="flex-1">
                  <h4
                    class="text-xs font-bold uppercase text-neutral-900 tracking-wide"
                  >
                    Venue
                  </h4>
                  <p class="text-base font-medium text-neutral-700">
                    {event.location}
                  </p>
                </div>
                <div
                  class="text-neutral-400 group-hover:text-yellow-600 transition-colors"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-5 h-5"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                    />
                  </svg>
                </div>
              </a>
            ) : (
              <div
                class="flex items-start gap-4 p-5 bg-neutral-50 rounded-xl border border-neutral-200"
              >
                <div class="p-2 bg-yellow-400 rounded-lg">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-5 h-5 text-neutral-900"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                  </svg>
                </div>
                <div>
                  <h4
                    class="text-xs font-bold uppercase text-neutral-900 tracking-wide"
                  >
                    Venue
                  </h4>
                  <p class="text-base font-medium text-neutral-700">
                    {event.location}
                  </p>
                </div>
              </div>
            )}
          </div>

          <div class="md:col-span-5 flex flex-col gap-4">
            {isPast ? (
              <div class="text-center bg-neutral-100 px-8 py-5 rounded-full">
                <span class="text-sm font-bold text-neutral-500">
                  Event has ended
                </span>
              </div>
            ) : event.registrationStatus ? (
              <a
                href={`/events/${event.slug}/register/`}
                target="_blank"
                class="flex items-center justify-center text-center text-sm font-bold bg-yellow-500 text-white gap-3 px-8 py-4 rounded-full hover:bg-neutral-900 transition-colors"
              >
                Register Now 
                <svg 
                  xmlns="http://www.w3.org/2000/svg" 
                  width="32" 
                  height="32" 
                  viewBox="0 0 24 24">
                    <path 
                      fill="none" 
                      stroke="currentColor" 
                      stroke-linecap="round" 
                      stroke-linejoin="round" 
                      stroke-width="2" 
                      d="M5 12h14m-4 4l4-4m-4-4l4 4"
                    />
                  </svg>
              </a>
            ) : (
              <div class="text-center bg-neutral-100 px-8 py-5 rounded-full">
                <span class="text-sm font-bold text-neutral-500">
                  Registration Closed
                </span>
              </div>
            )}
            
            {event.attendees && (
              <p class="text-xs text-center text-neutral-400">
                {event.attendees}
                {isPast ? " attended" : " attending"}
              </p>
            )}

            <!-- Perks Note -->
            {!isPast && event.registrationStatus && (
              <div class="mt-2 p-4 bg-amber-50 border border-amber-200 rounded-xl">
                <div class="flex gap-3">
                  <div class="shrink-0">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="w-5 h-5 text-amber-600"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                  </div>
                  <div>
                    <p class="text-sm font-semibold text-amber-800">
                      Free meal included
                    </p>
                    <p class="text-xs text-amber-700 mt-1 leading-relaxed">
                      Registered attendees will receive a complimentary meal box at the event. Walk-ins are welcome but meals are not guaranteed.
                    </p>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      </header>

      <!-- Event Image -->
      {event.image && (
        <section class="mb-12">
          <div class="rounded-2xl overflow-hidden border border-neutral-200">
            <Image
              src={event.image}
              alt={event.title}
              class="w-full h-64 md:h-full object-cover"
            />
          </div>
        </section>
      )}

      <!-- Speakers -->
      {event.speakers && event.speakers.length > 0 && (
        <section class="mb-12">
          <h2
            class="text-xs font-bold uppercase tracking-wide text-neutral-400 mb-6 flex items-center gap-4"
          >
            Speakers <span class="h-px flex-1 bg-neutral-200"></span>
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {event.speakers.map((speaker) => (
              <div class="p-4 bg-neutral-50 rounded-xl border border-neutral-200">
                <div class="flex gap-4 items-center">
                  <div class="w-16 h-16 shrink-0 overflow-hidden rounded-full border-2 border-white">
                    <Image
                      src={speaker.image}
                      alt={speaker.name}
                      class="w-full h-full object-cover"
                    />
                  </div>
                  <div class="flex-1">
                    <p class="text-[10px] font-bold text-yellow-600 uppercase tracking-wide">
                      {speaker.topic}
                    </p>
                    <h3 class="text-lg font-bold text-neutral-900">
                      {speaker.name}
                    </h3>
                    {speaker.desc && (
                      <p class="text-xs text-neutral-500 mt-1">{speaker.desc}</p>
                    )}
                  </div>
                </div>

                <!-- Slides link (for past events) -->
                {isPast && speaker.slidesUrl && (
                  <a
                    href={speaker.slidesUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="mt-4 flex items-center justify-between gap-2 px-4 py-3 bg-white rounded-lg border border-neutral-200 hover:border-yellow-300 transition-colors group"
                  >
                    <div class="flex items-center gap-3">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="w-5 h-5 text-neutral-400 group-hover:text-yellow-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"
                        />
                      </svg>
                      <span class="text-sm font-medium text-neutral-700 group-hover:text-yellow-600">
                        View Slides
                      </span>
                    </div>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="w-4 h-4 text-neutral-400 group-hover:text-yellow-600"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                      />
                    </svg>
                  </a>
                )}
              </div>
            ))}
          </div>
        </section>
      )}

      <!-- Agenda -->
      {event.agenda && event.agenda.length > 0 && (
        <section class="bg-neutral-900 p-6 md:p-8 rounded-2xl text-white mb-12">
          <div class="flex items-center justify-between mb-8">
            <h2 class="text-xs font-bold tracking-wide uppercase">
              Event Timeline
            </h2>
            <span
              class="text-[10px] font-medium px-3 py-1 border border-neutral-700 rounded-full"
            >
              WIT (East Indonesia Time)
            </span>
          </div>

          <div class="space-y-1">
            {event.agenda.map((item) => (
              <div class="flex items-center gap-6 py-4 border-b border-neutral-800 last:border-0">
                <span class="font-mono text-xs font-bold text-yellow-400 w-12">
                  {item.time}
                </span>
                <div class="flex flex-col md:flex-row md:items-center md:justify-between w-full gap-1">
                  <h4 class="text-sm font-medium text-white">{item.title}</h4>
                  <p class="text-[10px] text-neutral-400 font-medium uppercase tracking-wide">
                    {item.sub}
                  </p>
                </div>
              </div>
            ))}
          </div>
        </section>
      )}

      <!-- Recap Section (for past events) -->
      {isPast && (
        <section
          class="p-6 md:p-8 bg-yellow-50 rounded-2xl border border-yellow-200"
        >
          <h2
            class="text-xs font-bold uppercase tracking-wide text-yellow-700 mb-4 flex items-center gap-4"
          >
            Event Recap <span class="h-px flex-1 bg-yellow-200"></span>
          </h2>

          <p class="text-neutral-700 mb-6">
            This event has ended. Thank you to everyone who participated!
          </p>

          <div class="flex flex-wrap gap-3">
            {event.recapUrl && (
              <a
                href={event.recapUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 px-4 py-2 bg-white rounded-lg border border-yellow-200 text-sm font-medium text-yellow-700 hover:border-yellow-400 transition-colors"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-4 h-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                  />
                </svg>
                Read recap article
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-3 h-3"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                  />
                </svg>
              </a>
            )}

            {event.documentationUrl && (
              <a
                href={event.documentationUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 px-4 py-2 bg-white rounded-lg border border-yellow-200 text-sm font-medium text-yellow-700 hover:border-yellow-400 transition-colors"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-4 h-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                  />
                </svg>
                View photos
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-3 h-3"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                  />
                </svg>
              </a>
            )}
          </div>

          {event.galleryImages && event.galleryImages.length > 0 && (
            <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-3">
              {event.galleryImages.slice(0, 4).map((img) => (
                <div class="rounded-lg overflow-hidden border border-yellow-200">
                  <Image
                    src={img}
                    alt="Event gallery"
                    class="w-full h-24 object-cover"
                  />
                </div>
              ))}
            </div>
          )}
        </section>
      )}
    </article>
  </main>
</Layout>